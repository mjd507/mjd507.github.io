<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>代理和信托-项目总结 | Jiandong</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script src="https://www.googletagmanager.com/gtag/js?id=G-566LR096XR" async></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-566LR096XR');
</script><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">代理和信托-项目总结</h1><a id="logo" href="/.">Jiandong</a><p class="description">Stop stopping</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">代理和信托-项目总结</h1><div class="post-meta">2025-08-08<span> | </span><span class="category"><a href="/categories/Big-Back-End/">Big-Back-End</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">Contents</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%BA%E5%88%B8%E5%8F%91%E8%A1%8C-Issuance"><span class="toc-number">2.</span> <span class="toc-text">债券发行(Issuance)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#main-tables"><span class="toc-number">2.1.</span> <span class="toc-text">main tables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#file-mapper"><span class="toc-number">2.2.</span> <span class="toc-text">file-mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#skeleton-instrument"><span class="toc-number">2.3.</span> <span class="toc-text">skeleton-instrument</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E5%A2%83%E6%94%AF%E4%BB%98"><span class="toc-number">3.</span> <span class="toc-text">跨境支付</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A6%E6%88%B7%E8%A1%8C-Account-Bank"><span class="toc-number">3.1.</span> <span class="toc-text">账户行(Account Bank)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PPA-Principe-Paying-Agent"><span class="toc-number">3.2.</span> <span class="toc-text">PPA(Principe Paying Agent)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPA"><span class="toc-number">3.3.</span> <span class="toc-text">IPA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B%E6%9C%8D%E5%8A%A1-payment-workflow"><span class="toc-number">3.4.</span> <span class="toc-text">支付流程服务 payment-workflow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E9%87%91%E6%89%98%E7%AE%A1-Custody"><span class="toc-number">4.</span> <span class="toc-text">资金托管(Custody)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.</span> <span class="toc-text">基础服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#swift-message"><span class="toc-number">5.1.</span> <span class="toc-text">swift-message</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#maintenance"><span class="toc-number">5.2.</span> <span class="toc-text">maintenance</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mail-service"><span class="toc-number">5.3.</span> <span class="toc-text">mail-service</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rate-fixing"><span class="toc-number">5.4.</span> <span class="toc-text">rate-fixing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ETL"><span class="toc-number">5.5.</span> <span class="toc-text">ETL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E7%AE%A1%E5%90%88%E8%A7%84"><span class="toc-number">6.</span> <span class="toc-text">监管合规</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E8%A3%81%E5%AE%A1%E6%9F%A5-Sanction-Screening"><span class="toc-number">6.1.</span> <span class="toc-text">制裁审查(Sanction Screening)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ISO-message-service"><span class="toc-number">6.2.</span> <span class="toc-text">ISO message service</span></a></li></ol></li></ol></div></div><div class="post-content"><p>代理和信托(Agency and Trust)：代理涵盖帮助投资机构&#x2F;投资者买卖证券，收益归投资者。信托涵盖财富管理，收益归约定的受益人。</p>
<span id="more"></span>

<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>代理和信托是一个存在很久（20年+）的项目，客户端是安装在 Windows 上一个应用程序，服务端是 c#，2020 年开始，决定迁移到更现代化的 web 系统来取代 Windows 上的程序，新项目使用微服务架构，技术栈 SpringBoot + Angular + Openshift，共用 Oracle 数据库。所有功能都包含 maker-checker 以及 audit-trail 等审计流程。</p>
<p>原始功能非常庞大，有一定的业务壁垒，整个迁移周期也是逐渐拉长，目前已经摊开了 40+ 服务模块（前后端各 20+），规划也排到了 2028 年。</p>
<p>以下列举我接触到的模块，模块开发采用<code>充血模型</code>，按照 ops（运营操作人员） 的需求，一点点往里面添加。</p>
<h2 id="债券发行-Issuance"><a href="#债券发行-Issuance" class="headerlink" title="债券发行(Issuance)"></a>债券发行(Issuance)</h2><p>目前是在一级市场进行发债，ops 在和 发行人，投资人等多方敲定好后，会准备一个 Excel 表格，列出要发行的债券发行号，金额，币种，发行人信息，债券类别等信息。系统根据 Excel 信息创建债券。</p>
<h3 id="main-tables"><a href="#main-tables" class="headerlink" title="main tables"></a>main tables</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> c_issuer ( <span class="comment">-- 发行主体信息表</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  issuer_name <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  issuer_type <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  client_id NUMBER, <span class="comment">-- 关联主体实体表 (client_contact)</span></span><br><span class="line">  inst_id NUMBER, <span class="comment">-- 关联债券主表 c_instrument</span></span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> c_instrument ( <span class="comment">-- 债券基本信息表， 1 issuer - 1 instrument</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  isin_code <span class="type">VARCHAR</span>(<span class="number">16</span>), <span class="comment">-- 债券代码</span></span><br><span class="line">  isin_name <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  isin_type <span class="type">VARCHAR</span>(<span class="number">10</span>), <span class="comment">-- 国债、企业债、公司债、短融等</span></span><br><span class="line">  issue_scale <span class="type">DECIMAL</span>, <span class="comment">-- 发行面额规模</span></span><br><span class="line">  interest_type <span class="type">VARCHAR</span>(<span class="number">16</span>), <span class="comment">-- 计息方式（固定利率、浮动利率等）</span></span><br><span class="line">  coupon_rate <span class="type">DECIMAL</span>, <span class="comment">-- 票面利率（年化，%）</span></span><br><span class="line">  issue_start_date <span class="type">DATE</span>,</span><br><span class="line">  issue_end_date <span class="type">DATE</span>,</span><br><span class="line">  maturity_date <span class="type">DATE</span>,</span><br><span class="line">  issue_status <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> a_event ( <span class="comment">-- 债券发行方案表，1 instrument - n event</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  inst_id NUMBER, <span class="comment">-- 关联债券主表 c_instrument</span></span><br><span class="line">  currency <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  evt_type <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">  initial_balance <span class="type">DECIMAL</span>,</span><br><span class="line">  conf_bal <span class="type">DECIMAL</span>,</span><br><span class="line">  unconf_bal <span class="type">DECIMAL</span>,</span><br><span class="line">  value_dt <span class="type">DATE</span>,</span><br><span class="line">  usd_currency <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  status <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>发行完成后，理论上有一个认购流程，但是我涉及到的系统并没有涉及到认购流程，猜测发债采取的非公开发行的方式（私募债），仅面向合格机构投资者，认购门槛高（如单笔数百万起），通过线下协议认购。</p>
<p>线下认购完成后，ops 手动初始化 payment。（todo: need confirm， payment 哪个字段关联的投资者）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> a_payment ( <span class="comment">-- 投资认购支付表， 1 event - n payments</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  evt_id NUMBER,</span><br><span class="line">  pmt_no <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">  pmt_amount <span class="type">DECIMAL</span>,</span><br><span class="line">  pmt_method <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  pmt_status <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  pmt_currency <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  pmt_date <span class="type">DATE</span>,</span><br><span class="line">  pmd_addl_checker NUMBER, <span class="comment">-- risk control table, multi-checker involved.</span></span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="file-mapper"><a href="#file-mapper" class="headerlink" title="file-mapper"></a>file-mapper</h3><p>原始的债券创建流程，包含了多个步骤，需要 ops 跟着 sop 一步一步关联操作，耗时且有一定操作错误的可能性，在新的系统上，我们设计了一个 file-mapper 模块，将债券创建的流程自动化。</p>
<p>按照 细化的债券总模版（上线前配置一次） -&gt; 自定义债券模板（基于总模板，用户自定义） -&gt; 债券具体文件（用户上传，基于自定义的模板）的流程，实现自动化债券发行。</p>
<p>细化总模板阶段，ops 会整理出债券发行所能收集到的字段，字段属性，字段格式，是否必须，默认值等。比如债券编号，发行时间，发行人，机构信息，发行金额，发行币种，利率 等等。</p>
<p>细化的字段非常多，但是每次发行不一定都需要所有这些字段，所以抽象出 自定义债券模板 这一步骤，这个流程里，ops 选择债券模板后，系统会弹出必要的字段，用户可直接使用必要字段创建一个配置模板，也可以继续添加一些可选字段，最后完成配置模版的创建。配置模版包含了，字段信息，字段在 excel 的 列 的角标信息等。</p>
<p>配置模板的创建是为 ops 最后一步上传文件的服务的，所以配置模板的字段一定要与上传的 Excel 文件匹配。 ops 选择配置，并上传 excel，系统会按照配置的内容解析（比如配置模板的第一个字段对应 excel 的第一列，第二个字段对应第五列等），最终按配置生成一个 json，通过 http 发给 issuance 债券服务来自动创建债券，同时提供结果页显示成功和失败的记录，方便参考和修改。</p>
<p>债券的主要 table 见以上 main tables。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- PREDINE TEMPLATE DATA (STATIC DATA) IN BELOW TWO TABLES.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> FM_TEMPLATE (</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  TYPE <span class="type">VARCHAR</span>(<span class="number">16</span>), <span class="comment">-- ISSUANCE CREATE/UPDATE , RATE-FIXING, CUTODY</span></span><br><span class="line">  NAME <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> FM_TEMPLATE_COLS (</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  TEMPLATE_ID NUMBER,</span><br><span class="line">  NAME <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  TYPE <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line">  INDEX NUMBER,</span><br><span class="line">  DFT_VAL <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  REQUIRED <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">  FORMAT <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- END</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- USER CREATE DATA IN BELOW TWO TABLES</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> FM_CONFIGURATION_TEMPLATE (</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  CONFIG_NAME_PREFIX <span class="type">VARCHAR</span>(<span class="number">64</span>),</span><br><span class="line">  TEMPLATE_ID NUMBER,</span><br><span class="line">  HAS_HEADER <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">  HEADER_CNT NUMBER,</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> FM_CONFIGURATION (</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  CONFIG_TEMPLATE_ID NUMBER,</span><br><span class="line">  CONFIG_NAME <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  COL_ID NUMBER,</span><br><span class="line">  COL_IDX NUMBER,</span><br><span class="line">  DFT_VAL <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- END</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- USER UPLOAD File</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> FM_UPLOAD (</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  FM_CONG_ID NUMBER,</span><br><span class="line">  FM_LOCATION <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  FM_STATUS <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> FM_PARSE_DETAIL ( <span class="comment">-- 记录解析信息，在 issuance 服务逐条解析创建时，try-catch-finally 最后统计入表。</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  FM_UPLOAD_ID NUMBER,</span><br><span class="line">  MSG <span class="type">VARCHAR</span>(<span class="number">2048</span>), <span class="comment">-- e.g 200/200 records successfully created. 198/200 records create, 2/200 failed, reason: xxx</span></span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- END</span></span><br></pre></td></tr></table></figure>

<p>note：由于 file-mapper 良好的设计，现在不仅支持债券的自动化创建，还支持其他模板业务的自动化流程，如 rate-fixing，custody，clearing-system 等。</p>
<h3 id="skeleton-instrument"><a href="#skeleton-instrument" class="headerlink" title="skeleton-instrument"></a>skeleton-instrument</h3><p>除了通过 file-mapper 创建债券，我们还构建了一个后台定时服务，对还没有发行但创建好的债券，进行数据重新计算（按汇率重新计算金额等），一个金融债券交易的骨架，大致包含如下信息：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;instrument_id&quot;</span>: <span class="string">&quot;FIN-INSTR-2023-0001&quot;</span>,  <span class="comment">// 金融工具唯一标识符</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;CREDIT&quot;</span>,  <span class="comment">// 类型：CREDIT(信用类)/EQUITY(权益类)/DERIVATIVE(衍生类)/PAYMENT(支付类)</span></span><br><span class="line">  <span class="attr">&quot;sub_type&quot;</span>: <span class="string">&quot;LETTER_OF_CREDIT&quot;</span>,  <span class="comment">// 子类型：如信用证、债券、汇票等</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;issuer&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;entity_id&quot;</span>: <span class="string">&quot;BANK-001&quot;</span>,  <span class="comment">// 发行机构ID</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Global Trade Bank&quot;</span>,  <span class="comment">// 发行机构名称</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;BANK&quot;</span>,  <span class="comment">// 发行机构类型：银行、企业、政府等</span></span><br><span class="line">    <span class="attr">&quot;country&quot;</span>: <span class="string">&quot;US&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;credit_rating&quot;</span>: <span class="string">&quot;AA+&quot;</span>  <span class="comment">// 发行机构信用评级</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;counterparty&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;entity_id&quot;</span>: <span class="string">&quot;CLIENT-12345&quot;</span>,  <span class="comment">// 交易对手ID</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;International Trading Co.&quot;</span>,  <span class="comment">// 交易对手名称</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;CORPORATE&quot;</span>,  <span class="comment">// 类型：企业、个人等</span></span><br><span class="line">    <span class="attr">&quot;country&quot;</span>: <span class="string">&quot;DE&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;terms&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;currency&quot;</span>: <span class="string">&quot;USD&quot;</span>,  <span class="comment">// 货币单位</span></span><br><span class="line">    <span class="attr">&quot;principal_amount&quot;</span>: <span class="number">500000.00</span>,  <span class="comment">// 本金金额</span></span><br><span class="line">    <span class="attr">&quot;issue_date&quot;</span>: <span class="string">&quot;2023-11-15&quot;</span>,  <span class="comment">// 发行日期</span></span><br><span class="line">    <span class="attr">&quot;maturity_date&quot;</span>: <span class="string">&quot;2024-11-15&quot;</span>,  <span class="comment">// 到期日</span></span><br><span class="line">    <span class="attr">&quot;interest_rate&quot;</span>: &#123;  <span class="comment">// 利率条款（如适用）</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;FIXED&quot;</span>,  <span class="comment">// 固定/浮动</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span>: <span class="number">3.5</span>,  <span class="comment">// 利率值</span></span><br><span class="line">      <span class="attr">&quot;basis&quot;</span>: <span class="string">&quot;ANNUAL&quot;</span>  <span class="comment">// 计息基础</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;payment_schedule&quot;</span>: [  <span class="comment">// 支付计划（如适用）</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;due_date&quot;</span>: <span class="string">&quot;2024-05-15&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;amount&quot;</span>: <span class="number">8750.00</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;INTEREST&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;due_date&quot;</span>: <span class="string">&quot;2024-11-15&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;amount&quot;</span>: <span class="number">508750.00</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;PRINCIPAL_AND_INTEREST&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;collateral&quot;</span>: &#123;  <span class="comment">// 抵押品信息（如适用）</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;REAL_ESTATE&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Commercial property in Berlin&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;value&quot;</span>: <span class="number">750000.00</span>,</span><br><span class="line">    <span class="attr">&quot;valuation_date&quot;</span>: <span class="string">&quot;2023-11-01&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;governing_terms&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;law_jurisdiction&quot;</span>: <span class="string">&quot;New York, USA&quot;</span>,  <span class="comment">// 适用法律管辖地</span></span><br><span class="line">    <span class="attr">&quot;dispute_resolution&quot;</span>: <span class="string">&quot;ARBITRATION&quot;</span>,  <span class="comment">// 争议解决方式</span></span><br><span class="line">    <span class="attr">&quot;amendment_provisions&quot;</span>: <span class="string">&quot;REQUIRES_ALL_PARTIES&quot;</span>  <span class="comment">// 修改条款</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="attr">&quot;status&quot;</span>: <span class="string">&quot;ACTIVE&quot;</span>,  <span class="comment">// 状态：DRAFT/ACTIVE/EXPIRED/CANCELLED</span></span><br><span class="line">  <span class="attr">&quot;events&quot;</span>: [  <span class="comment">// 事件记录</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;event_type&quot;</span>: <span class="string">&quot;ISSUED&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;2023-11-15T10:30:00Z&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Instrument issued by Global Trade Bank&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="跨境支付"><a href="#跨境支付" class="headerlink" title="跨境支付"></a>跨境支付</h2><h3 id="账户行-Account-Bank"><a href="#账户行-Account-Bank" class="headerlink" title="账户行(Account Bank)"></a>账户行(Account Bank)</h3><p>账户行跟债券没有关系，它是一家银行在另一家银行开立账户，并通过该账户进行跨境支付，清算等金融服务。</p>
<p>新系统对账户行迁移了两块重要内容。</p>
<ol>
<li>展示清算通知的记录（receive-queue），即以 MT910 为核心的 record，MT910 是账户行在资金接收环节中，向账户持有人传递到账信息的核心工具，是清算的通知凭证。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> swift_outgoing_message <span class="keyword">where</span> msg_type <span class="operator">=</span> <span class="string">&#x27;910&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- display in ui</span></span><br></pre></td></tr></table></figure>


<ol start="2">
<li>对符合要求的账户，自动进去结算(MT103&#x2F;MT202)，（工作日 9 - 6 点，每 15 mins）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">autoPaymentRelease</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> payments = getValidatedPayments();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> p : payments) &#123;</span><br><span class="line">    sendReleaseMsgToPaymentWorkflow(p);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="PPA-Principe-Paying-Agent"><a href="#PPA-Principe-Paying-Agent" class="headerlink" title="PPA(Principe Paying Agent)"></a>PPA(Principe Paying Agent)</h3><p>当投资者购买了我们一级市场发行的债券，由于持有人分布在不同国家 &#x2F; 地区，需要通过 PPA 统一协调付款流程，我们也重新设计了 PPA 服务。</p>
<ul>
<li>支持创建需要支付的 payment</li>
<li>payment 验证过程中，增加多种风控策略（按金额大小&#x2F;级别审核）</li>
<li>引入 mq，在验证通过后，发到 mq，由 payment-workflow 服务统一对外支付</li>
<li>对特定币种，特定阈值下的 payment，支持自动 release。</li>
</ul>
<p>claim-letter 在 ppa 中的作用是？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">paymentRelease</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    releaseFunding();</span><br><span class="line">  &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  validateStatus();</span><br><span class="line">  checkBalance();</span><br><span class="line">  updateStatusDenomination();</span><br><span class="line">  sendSwiftMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="IPA"><a href="#IPA" class="headerlink" title="IPA"></a>IPA</h3><h3 id="支付流程服务-payment-workflow"><a href="#支付流程服务-payment-workflow" class="headerlink" title="支付流程服务 payment-workflow"></a>支付流程服务 payment-workflow</h3><hr>
<h2 id="资金托管-Custody"><a href="#资金托管-Custody" class="headerlink" title="资金托管(Custody)"></a>资金托管(Custody)</h2><p>新的服务重新设计了托管账号相关的管理功能，MT537 结算通知相关的功能，以及新开发的托管支付流程。</p>
<ol>
<li>托管账号管理 (safekeeping account)。</li>
</ol>
<p>方便托管人与搜托人进行沟通，以及交易结算。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">create</span> ct_sfkp ( <span class="comment">-- 托管资产表</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  sfkp_no <span class="type">VARCHAR</span>(<span class="number">32</span>), <span class="comment">-- e.g. SK202508120001</span></span><br><span class="line">  sfkp_acc_id <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  assert_type <span class="type">VARCHAR</span>(<span class="number">4</span>), <span class="comment">-- 资产类型，一般为债券</span></span><br><span class="line">  assert_code <span class="type">VARCHAR</span>(<span class="number">32</span>), <span class="comment">-- 债券的话为 isin_code</span></span><br><span class="line">  currency <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  status <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  start_date <span class="type">DATE</span>,</span><br><span class="line">  maturity_date <span class="type">DATE</span>,</span><br><span class="line">  last_valuation_date <span class="type">DATE</span>,</span><br><span class="line">  agreement_id NUMBER, <span class="comment">-- 关联托管协议编号</span></span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> ct_sfkp_acc ( <span class="comment">-- 托管账户</span></span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  sfkp_acc <span class="type">VARCHAR</span>(<span class="number">32</span>), <span class="comment">-- unique</span></span><br><span class="line">  client_id NUMBER, <span class="comment">-- 关联客户实体表 (client_contact)</span></span><br><span class="line">  status <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>MT537 (Securities Settlement Transaction Status Advice - 证券结算交易状态通知）。</li>
</ol>
<p>它主要用于在证券交易的结算环节，向相关参与方（如托管行、经纪商、客户等）通知证券结算交易的处理状态，例如确认交易已完成、提示交易失败及原因，通知部分结算等。</p>
<p>托管行根据每个工作日最新证券结算的相关状态数据，计算出托管账户最新的持仓信息，并通过 MT537 通知给客户。</p>
<p>虽从公司角度，MT537 是由我们托管行发出的，但是作为一个内部系统，我们也是 MT537 的一个接受方，系统会基于 MT537 生成 daily&#x2F;monthly 的 pdf 的详细结算信息，ops 每个月也会将 monthly 投资信息的 pdf 通过 email 发送给 客户。</p>
<p>所以基于 MT537 反向创建 safekeeping account，也是我们系统的一个功能。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ct_sfkp_penalty(</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  sfkp_acc <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  transaction_ref <span class="type">VARCHAR</span>(<span class="number">64</span>), <span class="comment">-- 20C</span></span><br><span class="line">  status_code <span class="type">VARCHAR</span>(<span class="number">4</span>), <span class="comment">-- 23G, &#x27;STLD&#x27;= 已结算，&#x27;PEND&#x27;= 待处理，&#x27;RJCT&#x27;= 被拒绝</span></span><br><span class="line">  status_reason <span class="type">VARCHAR</span>(<span class="number">4</span>), <span class="comment">-- 79A &#x27;INSU&#x27;= 资金不足，&#x27;INVA&#x27;= 无效账户</span></span><br><span class="line">  isin_code <span class="type">VARCHAR</span>(<span class="number">32</span>), </span><br><span class="line">  quantity <span class="type">DECIMAL</span>,</span><br><span class="line">  currency <span class="type">VARCHAR</span>(<span class="number">4</span>),</span><br><span class="line">  settlement_date <span class="type">DATE</span>,</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ct_sfkp_penalty_report(</span><br><span class="line">  ID NUMBER AUTO_INCREMENT,</span><br><span class="line">  sfkp_acc <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  frequency <span class="type">VARCHAR</span>(<span class="number">4</span>), <span class="comment">-- daily/monthly</span></span><br><span class="line">  location <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  CREATED_AT <span class="type">DATE</span>,</span><br><span class="line">  UPDATED_AT <span class="type">DATE</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>托管支付流程 custody payment instruction</li>
</ol>
<p>是一个新功能，或者说简化 ops 工作量的功能。</p>
<ul>
<li>构建基于邮件的 payment 流程。 含盖 receive&#x2F;authorise&#x2F;signature&#x2F;completed 等阶段。</li>
</ul>
<hr>
<h2 id="基础服务"><a href="#基础服务" class="headerlink" title="基础服务"></a>基础服务</h2><h3 id="swift-message"><a href="#swift-message" class="headerlink" title="swift-message"></a>swift-message</h3><ol>
<li>central entry for all kinds of incoming messages.</li>
</ol>
<h3 id="maintenance"><a href="#maintenance" class="headerlink" title="maintenance"></a>maintenance</h3><ol>
<li>payment currency cutoff time </li>
<li>payment threshold（checker 1&#x2F;2&#x2F;3）</li>
</ol>
<h3 id="mail-service"><a href="#mail-service" class="headerlink" title="mail-service"></a>mail-service</h3><ol>
<li>reading payment instruction emails from specified mailboxes and save into database.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> inbound_mail ( <span class="comment">-- 邮箱里的邮件信息</span></span><br><span class="line">  id NUMBER AUTO_INCREMENT,</span><br><span class="line">  mailbox <span class="type">VARCHAR</span>(<span class="number">32</span>), <span class="comment">-- 哪个邮箱</span></span><br><span class="line">  msg_id <span class="type">VARCHAR</span>(<span class="number">255</span>), <span class="comment">-- 每封邮件的唯一 id</span></span><br><span class="line">  subject <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">from</span> <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  <span class="keyword">to</span> <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  cc <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">  receive_date <span class="type">DATE</span>,</span><br><span class="line">  mail_content <span class="type">CLOB</span> <span class="comment">-- 整个邮件的内容</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> inbound_mail_attachment ( <span class="comment">-- 每封邮件的附件</span></span><br><span class="line">  id NUMBER AUTO_INCREMENT,</span><br><span class="line">  mail_id NUMBER,</span><br><span class="line">  attachment <span class="type">CLOB</span></span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>route the mail into configured modules base on mailbox<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> mail_routing(</span><br><span class="line">  id NUMBER AUTO_INCREMENT,</span><br><span class="line">  module_name <span class="type">VARCHAR</span>(<span class="number">32</span>),</span><br><span class="line">  mailbox <span class="type">VARCHAR</span>(<span class="number">32</span>)</span><br><span class="line">  receive_url <span class="type">VARCHAR</span>(<span class="number">32</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>由于公司的创建的邮箱只支持 pop3 协议，所以只能通过定时拉取的方式（每 5 分钟）获取 inbox 目录所有的邮件。</p>
<p>只要一封邮件被持久化了，后面在拉取，属于一种浪费，但由于没有更好的办法，我们采取了一种折中策略，即拉取后，按 receive date 过滤出最近两天的邮件，<br>随着时间推移，邮件越积越多，对系统是个负担，</p>
<h3 id="rate-fixing"><a href="#rate-fixing" class="headerlink" title="rate-fixing"></a>rate-fixing</h3><h3 id="ETL"><a href="#ETL" class="headerlink" title="ETL"></a>ETL</h3><ol>
<li>spring-batch jobs for different kinds of feeds</li>
<li>spring-integration poller tasks for differnet eip flow</li>
</ol>
<hr>
<h2 id="监管合规"><a href="#监管合规" class="headerlink" title="监管合规"></a>监管合规</h2><h3 id="制裁审查-Sanction-Screening"><a href="#制裁审查-Sanction-Screening" class="headerlink" title="制裁审查(Sanction Screening)"></a>制裁审查(Sanction Screening)</h3><ol>
<li>MT series messages screening</li>
<li>ISO messages screening</li>
<li>build message Canonical model to unify screening process.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">performScreening</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hdr = generateXmlHeader();</span><br><span class="line">  <span class="keyword">var</span> body = generateXmlBody();</span><br><span class="line">  sendToMqForScreening(<span class="keyword">new</span> String(hdr+<span class="string">&quot;\n&quot;</span>+body));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ISO-message-service"><a href="#ISO-message-service" class="headerlink" title="ISO message service"></a>ISO message service</h3></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>Title: </span>代理和信托-项目总结</p><p><span>Author: </span>Jiandong</p><p><span>Date: </span>2025-08-08</p><p><span>Last Update: </span>2025-08-16</p><p><span>Blog Link: </span><a href="/2025/08/08/time-in-citi/">https://mjd507.github.io/2025/08/08/time-in-citi/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://mjd507.github.io/2025/08/08/time-in-citi/"></i></span></p><p><span>Copyright Declaration: </span>Please refer carefully, most of the content I have not fully mastered.</p></div><br><div class="tags"></div><div class="post-nav"><a class="next" href="/2025/07/27/RestClient/">RestClient</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitalk/dist/gitalk.css"><script type="text/javascript" src="https://unpkg.com/blueimp-md5/js/md5.js"></script><script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
  clientID: 'fa8d49cc90698365347d',
  clientSecret: 'ad101f458b7f3950fccc09b931977c106cd2c467',
  repo: 'mjd507.github.io',
  owner: 'mjd507',
  admin: ['mjd507'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Big-Back-End/">Big-Back-End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Big-Front-End/">Big-Front-End</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://dashaun.com/posts/" title="DaShaun Carter" target="_blank">DaShaun Carter</a><ul></ul><a href="https://develotters.com/" title="develotters" target="_blank">develotters</a><ul></ul><a href="https://vladmihalcea.com/blog/" title="Vlad Mihalcea" target="_blank">Vlad Mihalcea</a><ul></ul><a href="https://www.danvega.dev/blog/" title="Dan Vega" target="_blank">Dan Vega</a><ul></ul><a href="https://imququ.com/" title="Jerry Qu" target="_blank">Jerry Qu</a><ul></ul><a href="https://www.techtalksweekly.io/" title="Tech Talks Weekly" target="_blank">Tech Talks Weekly</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">Jiandong.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>
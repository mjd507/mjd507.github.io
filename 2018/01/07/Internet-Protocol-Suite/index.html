<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>TCP/IP 协议入门 | mjd507</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/dark.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '1c847d4fb515d19b6108f15a5387f1d6';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">TCP/IP 协议入门</h1><a id="logo" href="/.">mjd507</a><p class="description">Stop stopping</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">TCP/IP 协议入门</h1><div class="post-meta">2018-01-07<span> | </span><span class="category"><a href="/categories/Network/">Network</a></span></div><div class="post-content"><p>教科书上把网络通信协议 OSI（Open System Interconnection）参考模型分成了 7 层，这 7 层模型撑起了网络通信的骨架，是一个理想的模型，而 TCP/IP 协议大致上实现了这种骨架，相比 OSI模型， TCP/IP 更加实用，因此在互联网众多通信协议中最为著名，有人把 TCP/IP 协议分为 4 层，有人分为 5 层，我认为划分为 5 层，更容易理解。</p>
<span id="more"></span>

<h2 id="1-OSI-amp-TCP-IP-协议模型"><a href="#1-OSI-amp-TCP-IP-协议模型" class="headerlink" title="1. OSI  &amp; TCP/IP 协议模型"></a>1. OSI  &amp; TCP/IP 协议模型</h2><p>下面表格展示了 OSI 7 层参考模型 与 TCP/IP 协议 5 层模型的对比，以及每层所定义的一些协议。</p>
<table>
<thead>
<tr>
<th align="left">OSI 7 层模型</th>
<th align="left">TCP/IP 模型</th>
<th>协议</th>
</tr>
</thead>
<tbody><tr>
<td align="left">应用层（Application Layer）</td>
<td align="left">应用层（Application Layer）</td>
<td>HTTP, FTP, SMTP, POP3 …</td>
</tr>
<tr>
<td align="left">表示层（Presentation Layer）</td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td align="left">会话层（Session Layer）</td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td align="left">传输层（Transport Layer）</td>
<td align="left">传输层（Transport Layer）</td>
<td>TCP, UDP</td>
</tr>
<tr>
<td align="left">网络层（Networking Layer）</td>
<td align="left">网络层（Networking Layer）</td>
<td>IP，ARP, ICMP</td>
</tr>
<tr>
<td align="left">数据链路层（Datalink Layer）</td>
<td align="left">数据链路层（Datalink Layer）</td>
<td>以太网, 无线通信, PPP…</td>
</tr>
<tr>
<td align="left">物理层（Physical Layer）</td>
<td align="left">物理层（Physical Layer）</td>
<td></td>
</tr>
</tbody></table>
<p>简单解释一下<strong>协议</strong>：它是事先达成的一种「约定」，是计算机与计算机之间通过网络实现通信时，必须遵循这一约定的规范。</p>
<p>层与层之间通过接口进行通信。发送端数据从应用层开始，一层一层向下传输，接收端，从物理层开始，向上一层一层解析获得数据。</p>
<h2 id="2-物理层"><a href="#2-物理层" class="headerlink" title="2. 物理层"></a>2. 物理层</h2><p>TCP/IP 对于物理层并没有作出定义，因此，有些地方将物理层与数据链路层划分在一层，即数据链路和物理层。</p>
<p>这里按照 OSI 的参考模型解释一下物理层，负责从源设备的物理层到目标设备的物理层的数据的最终传输。传输方式可以是电缆，光纤，无线等网络通信媒介。</p>
<p>通信媒介之间处理的是电压的高低，光的闪灭以及电波的强弱等信号，而计算机是以二进制 0 1 来表示信息，物理层的作用就是将信号与二进制数据进行互转。</p>
<h2 id="3-数据链路层"><a href="#3-数据链路层" class="headerlink" title="3. 数据链路层"></a>3. 数据链路层</h2><p>数据链路层的协议定义了互连设备之间数据传输规范。该层处理的数据不是单纯的 0 1 序列，而是把它们组合为一个叫「帧」的块，再交给物理层传输。</p>
<h3 id="3-1-以太网"><a href="#3-1-以太网" class="headerlink" title="3.1 以太网"></a>3.1 以太网</h3><p>以太网是众多数据链路中，使用比较广泛的一种。其「帧」个格式包含：以太网首部，数据包和尾部。首部又包含目标 Mac 地址，源 Mac 地址，上层协议类型。数据包能容纳的数据范围为 46 ~ 1500 个字节。帧尾是一个 FCS （帧检验序列），占 4 个字节。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024423-b32c3600-8419-11eb-92da-36dcb226bf0f.png" alt="以太网帧结构"></p>
<p>在总线型与环路型网络中，以太网发送数据，是发向本网络所有的主机中，让每台主机自己去判断，是否为接受方。判断的依据就是自己的 Mac 地址与接受到的 Mac 地址是否相同。</p>
<h3 id="3-2-无线通信"><a href="#3-2-无线通信" class="headerlink" title="3.2 无线通信"></a>3.2 无线通信</h3><p>无线通信现在用的也很多，典型的就是现在手机的移动通信网络，简单介绍一下，跟以太网类似，也采用 Mac 地址来寻找主机，不过是通过基站的方式实现通信，其物理层使用电磁波或红外线来传输数据。</p>
<h2 id="4-网络层"><a href="#4-网络层" class="headerlink" title="4. 网络层"></a>4. 网络层</h2><p>IP（Internet Protocol）层即网络层，它的作用是实现了主机与主机之间点对点的通信。</p>
<p>IP 面向无连接。即在发包之前，不需要建立与对端目标地址之间的连接。上层如果有发送给 IP 的数据，会立即被 IP 包发送出去。</p>
<p>这样的好处有两个，一是简化，二是提速。面向连接比无连接相对复杂，管理每个连接本身就是一个很繁琐的事；如果每次通信都要建立连接，会降低处理速度。需要有连接时，可以委托给上层提供此服务。</p>
<h3 id="4-1-IP-首部"><a href="#4-1-IP-首部" class="headerlink" title="4.1 IP 首部"></a>4.1 IP 首部</h3><p>通过 IP 进行通信时，需要在数据的前面加入 IP 首部信息。IP 有 IPv4 和 IPv6 两种。IPv6 包的转发效率更高，省略了首部校验和字段，减轻了路由器的压力。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024478-f4bce100-8419-11eb-85a7-549edc34103c.png" alt="IPv4 首部"></p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024486-00100c80-841a-11eb-9787-60a54c4607a1.png" alt="IPv6 首部"></p>
<h3 id="4-2-路由控制"><a href="#4-2-路由控制" class="headerlink" title="4.2 路由控制"></a>4.2 路由控制</h3><p>IP 之所以能点对点通信，靠的是路由控制。IP 数据在每个区间内，采用「跳」的方式传递，每跳到一个路由器上，就会去查询路由控制表，找出下一次要跳转的路由器地址，直至到达目标地址。</p>
<p>网络层与数据链路层的关系。就像旅行时的行程表和火车票。每一张票只负责特地区间的运输，而行程表指导了运输的方向。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024496-0bfbce80-841a-11eb-9c3c-f7e780ca5e17.png" alt="点对点通信"></p>
<p>数据链路层的作用是在互连同一种数据链路的节点直接进行包传递，而一旦跨越多种数据链路，就需要借助路由。</p>
<h2 id="5-传输层"><a href="#5-传输层" class="headerlink" title="5. 传输层"></a>5. 传输层</h2><p>IP 首部有一个协议字段，用来标识网络层的上一层（传输层）采用的协议，在传输层有两个大家很熟的协议，TCP 和 UDP。 </p>
<p>一台主机上会有很多应用程序，传输层在有了协议之后，如何将数据传输到具体的应用程序，这时，采用了<strong>端口号</strong>这样一种识别码。</p>
<p>到这，识别一个通信需要采用 5 个信息，他们是：源 IP 地址、目标 IP 地址、协议号（TCP 或 UDP 的一种编号）、源端口号、目标端口号。只要其中一项不同，则不是同一个通信。</p>
<h3 id="5-1-UDP"><a href="#5-1-UDP" class="headerlink" title="5.1 UDP"></a>5.1 UDP</h3><p>UDP 不提供复杂的控制机制，利用 IP 提供面向无连接的通信服务。它是在应用程序的数据发来收到的那一刻，立即按照鸳鸯发送到网络上的一种机制。</p>
<p>所以即使网络拥堵，UDP 也无法进行流量控制等避免网络拥塞的行为；传输过程中，出现丢包，UDP 也不负责重发；甚至当包到达顺序错乱时，也不会自动纠正。</p>
<p>UDP 的使用场景多数在即时通信这块，随时发送数据，简单高效。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024503-1918bd80-841a-11eb-9149-c185310d7390.png" alt="UPD 首部"></p>
<h3 id="5-2-TCP"><a href="#5-2-TCP" class="headerlink" title="5.2 TCP"></a>5.2 TCP</h3><p>TCP 与 UDP 不同，区别相当大，TCP 可以说是对 「传输、发送、通信」进行控制的协议。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024520-28980680-841a-11eb-896a-55d84da38be0.png" alt="TCP 首部"></p>
<h4 id="5-2-1-序列号"><a href="#5-2-1-序列号" class="headerlink" title="5.2.1 序列号"></a>5.2.1 序列号</h4><p>TCP 中，当发送端的数据达到接受主机时，接收端主机会返回一个已经收到的消息的通知，这个消息就是确认应答（ACK）。如果一定时间内，发送到没有等到确认应答，就可以认为数据已经丢失，需要进行重发。</p>
<p>这里发送到没有收到确认应答，有两种可能，一是发送途中数据丢失，二是目标主机回传应答时数据丢失。对于后一种情况，如果按照重发机制发送数据，目标主机就会反复收到相同的数据。</p>
<p>为了对上次应用提供可靠的传输，必须放弃重复的数据包。因此，引入了序列号这种机制，即给发送的数据标上号码，接收端查询接受数据 TCP 首部的序列号和数据长度，将自己下一步应该接受的序号作为应答回传回去，就这样，通过序列号和确认应答号，就能实现可靠传输。</p>
<h4 id="5-2-2-重发超时的设置"><a href="#5-2-2-重发超时的设置" class="headerlink" title="5.2.2 重发超时的设置"></a>5.2.2 重发超时的设置</h4><p>重发超时是指在重发数据之前，等待确认应答数据的那个时间间隔。这个时间长短随着数据包途径的网络环境不同而不同，加上数据包的分段是经过不同线路到达的，因此，TCP 在每次发包时都会计算往返时间以及时间偏差，重发时间一般比往返时间和时间偏差的综合时间大一点。</p>
<p>Unix 以及 Windows 系统中，超时都以 0.5 秒为单位进行控制，因此，重发超时都是 0.5 秒的整数倍。不过，由于最初的数据包还不知道往返时间，所以其重发超时一般设置为 6 秒左右。</p>
<p>若重发之后还是收不到确认应答，则等待确认的时间将以 2 倍，4倍的指数函数延长，然后在进行重新发送。达到一定重发次数之后，会判断网络或主机发生了异常，强制关闭连接，通知应用通信异常，强行终止。</p>
<h4 id="5-2-3-连接管理"><a href="#5-2-3-连接管理" class="headerlink" title="5.2.3 连接管理"></a>5.2.3 连接管理</h4><p>TCP 连接与断开的过程，正常至少需要 7 个包才能完成，三次握手和四次挥手。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024530-3a79a980-841a-11eb-9d6f-b704f71776fb.png" alt="三次握手四次挥手"></p>
<h4 id="5-2-4-发送数据的长度"><a href="#5-2-4-发送数据的长度" class="headerlink" title="5.2.4 发送数据的长度"></a>5.2.4 发送数据的长度</h4><p>在建立 TCP 连接的同事，就可以确定数据包的单位，可称之为「最大消息长度」（MSS：Maximun Segment Size），最理想的情况，最大消息的长度正好是 IP 中不会被分片处理的最大数据长度。</p>
<p>TCP 在传输大量数据时，以 MSS 的大小将数据进行分割；重发意思以 MSS 为单位。</p>
<p>MSS 是在三次握手时，在两端主机之间被计算得出，两端主机在建立连接的请求时，会在 TCP 首部写入 MSS 选项，高度对方自己的接口能够适应的 MSS 的大小。然后会在两者之间选择一个较小的值使用。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024751-719c8a80-841b-11eb-81bb-8d1e10c7b3d9.png" alt="TCP以段为单位发生数据"></p>
<h4 id="5-2-5-利用窗口提速"><a href="#5-2-5-利用窗口提速" class="headerlink" title="5.2.5 利用窗口提速"></a>5.2.5 利用窗口提速</h4><p>TCP 以段为单位，为每个数据包进行确认应答，如果包的往返时间越长，通信性能越低，网络的吞吐量越差。为此，TCP 引入了窗口。确认应答不在是以每个分段，而是以更大的单位进行确认，转发时间会被大幅度缩短。简单讲，就是发送端主机，在发送了一个段之后，可以继续发送，而不必要一直等到确认应答再发送。</p>
<p><img src="https://user-images.githubusercontent.com/8939151/111024767-811bd380-841b-11eb-9ad0-ee00a9372e94.png" alt="TCP窗口缓冲"></p>
<p>窗口对丢包重发的管理更加的高效和灵活，在窗口比较大，有出现报文丢失的情况下，同一个序号的确认应答会被重复不断地返回，如果发送端主机连续三次收到同一个确认应答，就会将其对应的数据进行重发。</p>
<p>窗口的大小是由接收端主机来控制的，TCP 首部，专门有一个字段用来通知窗口的大小，接收端缓冲区在面临数据溢出时，窗口大小的值会随之被设为一个更小的值通知给发送端，从而控制数据发送量，这也形成了一个 TCP 的流控制。</p>
<h4 id="5-2-6-拥塞控制"><a href="#5-2-6-拥塞控制" class="headerlink" title="5.2.6 拥塞控制"></a>5.2.6 拥塞控制</h4><p>如果在通信刚开始的时候，就发送大量的数据，可能会导致网络拥堵，甚至导致网络瘫痪。TCP 为了防止该问题，在通信的一开始会通过一个叫做慢启动的算法算出数值，对发送数据量进行控制。</p>
<h2 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h2><p>应用层，与用户最近，该层最典型的协议就是 HTTP 协议。当然还有文件传输的 FTP 协议，发送 Email 的 SMTP协议等等。</p>
<p>TCP 和 IP 等下层协议是不依赖与上层应用类型的协议，而应用层协议则是为了实现某种应用而设计和创造的协议。应用开发者只要关注选用哪种协议，而不必担心应用中的数据应该以哪种方式发送到目标主机。</p>
<p>就到这里。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="http://item.jd.com/11253710.html">图解TCP/IP</a></p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>本文标题：</span>TCP/IP 协议入门</p><p><span>文章作者：</span>mjd507</p><p><span>发布时间：</span>2018-01-07</p><p><span>最后更新：</span>2021-09-07</p><p><span>原始链接：</span><a href="/2018/01/07/Internet-Protocol-Suite/">https://mjd507.github.io/2018/01/07/Internet-Protocol-Suite/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://mjd507.github.io/2018/01/07/Internet-Protocol-Suite/"></i></span></p><p><span>版权声明：</span>This station is mainly used to sort out incomprehensible knowledge. I have not fully mastered most of the content. Please refer carefully.</p></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="/2018/01/15/Use-netcat-to-transfer-TCP-UDP-Data/">使用 netcat 读写 TCP UDP 数据包</a><a class="next" href="/2017/10/14/Store-Algorithm/">算法储备</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=1.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=1.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=1.0.0"></script><script>var gitalk = new Gitalk({
  clientID: 'fa8d49cc90698365347d',
  clientSecret: 'ad101f458b7f3950fccc09b931977c106cd2c467',
  repo: 'mjd507.github.io',
  owner: 'mjd507',
  admin: ['mjd507'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Back-End/">Back-End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Big-Front-End/">Big-Front-End</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Structure-Algorithm/">Data Structure & Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Android/">Java & Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Operation-System/">Operation System</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://imququ.com/" title="Jerry Qu" target="_blank">Jerry Qu</a><ul></ul><a href="https://daimajia.com/" title="代码家" target="_blank">代码家</a><ul></ul><a href="https://sivers.org/" title="Derek Sivers" target="_blank">Derek Sivers</a><ul></ul><a href="http://www.hugogu.cn/" title="Hugo Gu" target="_blank">Hugo Gu</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">mjd507.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>